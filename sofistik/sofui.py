# Form implementation generated from reading ui file 'sofistik.ui'
#
# Created by: PyQt6 UI code generator 6.1.0
#
# WARNING: Any manual changes made to this file will be lost when pyuic6 is
# run again.  Do not edit this file unless you know what you are doing.
from pathlib import Path

from PyQt6.QtWidgets import QFileDialog, QWidget

from main import main

from PyQt6 import QtCore, QtGui, QtWidgets


class Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(916, 617)

        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")

        self.db_name = QtWidgets.QLabel(self.centralwidget)
        self.db_name.setGeometry(QtCore.QRect(20, 10, 81, 31))
        self.db_name.setObjectName("db_name")
        self.OKButton = QtWidgets.QPushButton(self.centralwidget)
        self.OKButton.setGeometry(QtCore.QRect(640, 20, 141, 61))
        self.OKButton.setStyleSheet("background-color: rgb(89, 255, 0);")
        self.OKButton.setObjectName("OKButton")
        self.plate_picture = QtWidgets.QLabel(self.centralwidget)
        self.plate_picture.setGeometry(QtCore.QRect(0, 130, 911, 441))
        self.plate_picture.setText("")
        self.plate_picture.setPixmap(QtGui.QPixmap("../sofistik/result/test_image_from_python.bmp"))
        self.plate_picture.setScaledContents(True)
        self.plate_picture.setObjectName("plate_picture")
        MainWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(MainWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 916, 22))
        self.menubar.setObjectName("menubar")
        self.menuFile = QtWidgets.QMenu(self.menubar)
        self.menuFile.setObjectName("menuFile")
        self.menuhelp = QtWidgets.QMenu(self.menubar)
        self.menuhelp.setObjectName("menuhelp")
        MainWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(MainWindow)
        self.statusbar.setObjectName("statusbar")
        MainWindow.setStatusBar(self.statusbar)
        self.actionOpen_database = QtGui.QAction(MainWindow)
        self.actionOpen_database.setObjectName("actionOpen_database")
        self.actionabout = QtGui.QAction(MainWindow)
        self.actionabout.setObjectName("actionabout")
        self.actionexit = QtGui.QAction(MainWindow)
        self.actionexit.setObjectName("actionexit")
        self.menuFile.addAction(self.actionOpen_database)
        self.menuFile.addSeparator()
        self.menuFile.addAction(self.actionexit)
        self.menuhelp.addAction(self.actionabout)
        self.menubar.addAction(self.menuFile.menuAction())
        self.menubar.addAction(self.menuhelp.menuAction())

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.db_name.setText(_translate("MainWindow", "TextLabel"))
        self.OKButton.setText(_translate("MainWindow", "OK"))
        self.menuFile.setTitle(_translate("MainWindow", "File"))
        self.menuhelp.setTitle(_translate("MainWindow", "help"))
        self.actionOpen_database.setText(_translate("MainWindow", "Open database..."))
        self.actionabout.setText(_translate("MainWindow", "about"))
        self.actionexit.setText(_translate("MainWindow", "exit"))


class Ui_Ask_plate(object):

    def setupUi(self, Ask_plate):
        Ask_plate.setObjectName("Ask_plate")
        Ask_plate.setEnabled(True)
        Ask_plate.resize(169, 94)
        self.plate_number_lable_text = QtWidgets.QLabel(Ask_plate)
        self.plate_number_lable_text.setGeometry(QtCore.QRect(10, 10, 161, 20))
        self.plate_number_lable_text.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.plate_number_lable_text.setObjectName("plate_number_lable_text")
        self.plate_number = QtWidgets.QSpinBox(Ask_plate)
        self.plate_number.setGeometry(QtCore.QRect(20, 40, 61, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        font.setBold(True)
        self.plate_number.setFont(font)
        self.plate_number.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.plate_number.setObjectName("plate_number")
        self.select_plate_OK = QtWidgets.QPushButton(Ask_plate)
        self.select_plate_OK.setGeometry(QtCore.QRect(90, 30, 71, 51))
        self.select_plate_OK.setStyleSheet("background-color: rgb(89, 255, 0);")
        self.select_plate_OK.setObjectName("select_plate_OK")
        self.select_plate_OK_pressed = QtGui.QAction(Ask_plate)
        self.select_plate_OK_pressed.setObjectName("select_plate_OK_pressed")
        self.select_plate_OK.clicked.connect(lambda: Ask_plate.hide())

        self.retranslateUi(Ask_plate)
        QtCore.QMetaObject.connectSlotsByName(Ask_plate)

    def retranslateUi(self, Ask_plate):
        _translate = QtCore.QCoreApplication.translate
        Ask_plate.setWindowTitle(_translate("Ask_plate", "Dialog"))
        self.plate_number_lable_text.setText(_translate("Ask_plate", "Введите номер пластины"))
        self.select_plate_OK.setText(_translate("Ask_plate", "OK"))
        self.select_plate_OK_pressed.setText(_translate("Ask_plate", "plate_selected"))
        self.select_plate_OK_pressed.setToolTip(
            _translate("Ask_plate", "<html><head/><body><p>Select plate and press OK</p></body></html>"))
        self.select_plate_OK_pressed.setShortcut(_translate("Ask_plate", "Return"))


class SofistikUI(Ui_MainWindow):

    def __init__(self):
        self.database = None
        self.ask_plate_number = None

    def after_setup_ui(self):
        self.actionOpen_database.triggered.connect(self.open_db)
        self.button_pushed()

    def button_pushed(self):
        self.OKButton.clicked.connect(lambda: self.action())

    def action(self):
        print(self.ask_plate_number.plate_number.text())
        main(self.database)
        self.plate_picture.setPixmap(QtGui.QPixmap("./result/test_image_from_python.bmp"))
        self.plate_picture.setScaledContents(True)
        self.plate_picture.setObjectName("label")

    def open_db(self):
        file_name, _ = QFileDialog.getOpenFileName(caption='Open database file',
                                                   filter='Db files [.cdb, .txt] (*.cdb *.txt)')
        self.database = Path(file_name)
        self.db_name.setText(self.database.name)
        self.ask_plate_number_dialog = QtWidgets.QDialog()
        self.ask_plate_number = Ui_Ask_plate()
        self.ask_plate_number.setupUi(self.ask_plate_number_dialog)
        self.ask_plate_number_dialog.show()


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = SofistikUI()
    ui.setupUi(MainWindow)
    ui.after_setup_ui()
    MainWindow.show()
    sys.exit(app.exec())

# Timer app

# from sys import exit as sysExit
# from time import sleep as tmSleep
#
# from PyQt6.QtCore import QCoreApplication, QObject, QThread, pyqtSignal, pyqtSlot
# from PyQt6.QtWidgets import QApplication, QWidget, QHBoxLayout, QVBoxLayout
# from PyQt6.QtWidgets import QPushButton, QLineEdit
#
#
# class Processor(QObject):
#     sigCount = pyqtSignal(int)
#
#     def __init__(self):
#         QObject.__init__(self)
#         self.Connected = True
#         self.StreamRdy = False
#         self.Count = 0
#         self.Delay = 0
#
#     def ProcessRunner(self):
#         while self.Connected:
#             if self.StreamRdy:
#                 self.Delay = 0
#                 self.Count += 1
#                 self.sigCount.emit(self.Count)
#                 tmSleep(0.5)
#             else:
#                 self.Count = 0
#                 self.Delay -= 1
#                 self.sigCount.emit(self.Delay)
#                 tmSleep(0.5)
#             QCoreApplication.processEvents()
#
#     @pyqtSlot()
#     def StartProcess(self):
#         self.StreamRdy = True
#
#     @pyqtSlot()
#     def PauseProcess(self):
#         self.StreamRdy = False
#
#
# class MainWindow(QWidget):
#     sigStrtUp = pyqtSignal()
#     sigPauser = pyqtSignal()
#
#     def __init__(self):
#         QWidget.__init__(self)
#
#         self.setWindowTitle('Main Window')
#         self.setGeometry(150, 150, 200, 200)
#
#         self.btnActivate = QPushButton('Start')
#         self.btnActivate.clicked.connect(self.Activated)
#
#         self.btnDeActivate = QPushButton('Pause')
#         self.btnDeActivate.clicked.connect(self.DeActivate)
#
#         self.btnExitApp = QPushButton('Quit')
#         self.btnExitApp.clicked.connect(self.ExitApp)
#
#         self.lneOutput = QLineEdit()
#
#         HBox = QHBoxLayout()
#         HBox.addWidget(self.btnActivate)
#         HBox.addWidget(self.btnDeActivate)
#         HBox.addWidget(self.btnExitApp)
#         HBox.addStretch(1)
#
#         VBox = QVBoxLayout()
#         VBox.addWidget(self.lneOutput)
#         VBox.addLayout(HBox)
#
#         self.setLayout(VBox)
#
#         self.EstablishThread()
#
#     def EstablishThread(self):
#         # Create the Object from Class
#         self.Prcssr = Processor()
#         # Assign the Database Signals to Slots
#         self.Prcssr.sigCount.connect(self.CountRecieve)
#         # Assign Signals to the Database Slots
#         self.sigStrtUp.connect(self.Prcssr.StartProcess)
#         self.sigPauser.connect(self.Prcssr.PauseProcess)
#
#         # Create the Thread
#         self.ThredHolder = QThread()
#         # Move the Listener to the Thread
#         self.Prcssr.moveToThread(self.ThredHolder)
#         # Assign the Listener Starting Function to the Thread Call
#         self.ThredHolder.started.connect(self.Prcssr.ProcessRunner)
#         # Start the Thread which launches Listener.Connect( )
#         self.ThredHolder.start()
#
#     @pyqtSlot(int)
#     def CountRecieve(self, Count):
#         self.lneOutput.setText('Count : ' + str(Count))
#
#     def Activated(self):
#         self.sigStrtUp.emit()
#
#     def DeActivate(self):
#         self.sigPauser.emit()
#
#     def ExitApp(self):
#         sysExit()
#
#
# if __name__ == '__main__':
#     MainThred = QApplication([])
#
#     MainGui = MainWindow()
#     MainGui.show()
#
#     sysExit(MainThred.exec())
